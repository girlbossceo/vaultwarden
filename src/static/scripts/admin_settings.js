"use strict";function smtpTest(e){if(e.preventDefault(),e.stopPropagation(),formHasChanges(config_form))return alert("Config has been changed but not yet saved.\nPlease save the changes first before sending a test email."),!1;const t=document.getElementById("smtp-test-email");if(null===t.value.match(/\S+@\S+/i))return t.parentElement.classList.add("was-validated"),!1;const n=JSON.stringify({email:t.value});_post(`${BASE_URL}/admin/test/smtp`,"SMTP Test email sent correctly","Error sending SMTP test email",n,!1)}function getFormData(){let e={};return document.querySelectorAll(".conf-checkbox").forEach((function(t){e[t.name]=t.checked})),document.querySelectorAll(".conf-number").forEach((function(t){e[t.name]=t.value?+t.value:null})),document.querySelectorAll(".conf-text, .conf-password").forEach((function(t){e[t.name]=t.value||null})),e}function saveConfig(e){const t=JSON.stringify(getFormData());_post(`${BASE_URL}/admin/config`,"Config saved correctly","Error saving config",t),e.preventDefault()}function deleteConf(e){e.preventDefault(),e.stopPropagation();"DELETE"===prompt("This will remove all user configurations, and restore the defaults and the values set by the environment. This operation could be dangerous. Type 'DELETE' to proceed:")?_post(`${BASE_URL}/admin/config/delete`,"Config deleted correctly","Error deleting config"):alert("Wrong input, please try again")}function backupDatabase(e){e.preventDefault(),e.stopPropagation(),_post(`${BASE_URL}/admin/config/backup_db`,"Backup created successfully","Error creating backup",null,!1)}function initChangeDetection(e){const t=["smtp-test-email"];Array.from(e).forEach((e=>{t.includes(e.id)||(e.dataset.origValue=e.value)}))}function formHasChanges(e){return Array.from(e).some((e=>"origValue"in e.dataset&&e.dataset.origValue!==e.value))}function preventFormSubmitOnEnter(e){e&&e.addEventListener("keypress",(e=>{"Enter"==e.key&&e.preventDefault()}))}function submitTestEmailOnEnter(){const e=document.getElementById("smtp-test-email");e&&e.addEventListener("keypress",(e=>{"Enter"==e.key&&(e.preventDefault(),smtpTest(e))}))}function colorRiskSettings(){const e=document.getElementsByClassName("col-form-label");Array.from(e).forEach((e=>{e.innerText.toLowerCase().includes("risks")&&(e.parentElement.className+=" alert-danger")}))}function toggleVis(e){e.preventDefault(),e.stopPropagation();const t=document.getElementById(e.target.dataset.vwPwToggle);"text"===t.getAttribute("type")?t.setAttribute("type","password"):t.setAttribute("type","text")}function masterCheck(e,t){const n=document.getElementById(e);if(n){const e=function(e,t){return function(){document.querySelectorAll(t).forEach((function(t){t.disabled=!e.checked})),e.disabled=!1}}(n,t);e(),n.addEventListener("change",e)}}function checkAdminToken(){const e=document.getElementById("input_admin_token");if(!document.getElementById("input_disable_admin_token").checked&&!e.value.startsWith("$argon2")){const e=localStorage.getItem("admin_token_warning_closed");if(null!==e){const t=new Date(parseInt(e));if(new Date-t<2592e6)return}const t=document.getElementById("admin_token_warning");t.addEventListener("closed.bs.alert",(function(){const e=new Date;localStorage.setItem("admin_token_warning_closed",e.getTime())})),t.classList.remove("d-none")}}function showWarnings(){checkAdminToken()}const config_form=document.getElementById("config-form");document.addEventListener("DOMContentLoaded",(()=>{initChangeDetection(config_form),preventFormSubmitOnEnter(config_form),submitTestEmailOnEnter(),colorRiskSettings(),document.querySelectorAll("input[id^='input__enable_']").forEach((e=>{const t=e.id.replace("input__enable_","#g_");masterCheck(e.id,`${t} input`)})),document.querySelectorAll("button[data-vw-pw-toggle]").forEach((e=>{e.addEventListener("click",toggleVis)}));const e=document.getElementById("backupDatabase");e&&e.addEventListener("click",backupDatabase);const t=document.getElementById("deleteConf");t&&t.addEventListener("click",deleteConf);const n=document.getElementById("smtpTest");n&&n.addEventListener("click",smtpTest),config_form.addEventListener("submit",saveConfig),showWarnings()}));