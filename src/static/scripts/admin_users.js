"use strict";function deleteUser(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;const n=prompt(`To delete user "${r}", please type the email below`);null!=n&&(n==r?_post(`${BASE_URL}/admin/users/${t}/delete`,"User deleted correctly","Error deleting user"):alert("Wrong email, please try again"))}function remove2fa(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;confirm(`Are you sure you want to remove 2FA for "${r}"?`)&&_post(`${BASE_URL}/admin/users/${t}/remove-2fa`,"2FA removed correctly","Error removing 2FA")}function deauthUser(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;confirm(`Are you sure you want to deauthorize sessions for "${r}"?`)&&_post(`${BASE_URL}/admin/users/${t}/deauth`,"Sessions deauthorized correctly","Error deauthorizing sessions")}function disableUser(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;confirm(`Are you sure you want to disable user "${r}"? This will also deauthorize their sessions.`)&&_post(`${BASE_URL}/admin/users/${t}/disable`,"User disabled successfully","Error disabling user")}function enableUser(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;confirm(`Are you sure you want to enable user "${r}"?`)&&_post(`${BASE_URL}/admin/users/${t}/enable`,"User enabled successfully","Error enabling user")}function updateRevisions(e){e.preventDefault(),e.stopPropagation(),_post(`${BASE_URL}/admin/users/update_revision`,"Success, clients will sync next time they connect","Error forcing clients to sync")}function inviteUser(e){e.preventDefault(),e.stopPropagation();const t=document.getElementById("inviteEmail"),r=JSON.stringify({email:t.value});t.value="",_post(`${BASE_URL}/admin/invite`,"User invited correctly","Error inviting user",r)}function resendUserInvite(e){e.preventDefault(),e.stopPropagation();const t=e.target.parentNode.dataset.vwUserUuid,r=e.target.parentNode.dataset.vwUserEmail;if(!t||!r)return alert("Required parameters not found!"),!1;confirm(`Are you sure you want to resend invitation for "${r}"?`)&&_post(`${BASE_URL}/admin/users/${t}/invite/resend`,"Invite sent successfully","Error resend invite")}const ORG_TYPES={0:{name:"Owner",bg:"orange",font:"black"},1:{name:"Admin",bg:"blueviolet"},2:{name:"User",bg:"blue"},3:{name:"Manager",bg:"green"}};jQuery.extend(jQuery.fn.dataTableExt.oSort,{"date-iso-pre":function(e){let t;const r=e.replace(/(<([^>]+)>)/gi,"").trim();if(""!==r){const e=r.split(" "),n=null!=e[1]?e[1].split(":"):["00","00","00"],a=e[0].split("-");t=1*(a[0]+a[1]+a[2]+n[0]+n[1]+(null!=n[2]?n[2]:0)),isNaN(t)&&(t=0)}else t=1/0;return t},"date-iso-asc":function(e,t){return e-t},"date-iso-desc":function(e,t){return t-e}});const userOrgTypeDialog=document.getElementById("userOrgTypeDialog");function updateUserOrgType(e){e.preventDefault(),e.stopPropagation();const t=JSON.stringify(Object.fromEntries(new FormData(e.target).entries()));_post(`${BASE_URL}/admin/users/org_type`,"Updated organization type of the user successfully","Error updating organization type of the user",t)}function initUserTable(){document.querySelectorAll("button[data-vw-org-type]").forEach((function(e){const t=ORG_TYPES[e.dataset.vwOrgType];e.style.backgroundColor=t.bg,void 0!==t.font&&(e.style.color=t.font),e.title=t.name})),document.querySelectorAll("button[vw-remove2fa]").forEach((e=>{e.addEventListener("click",remove2fa)})),document.querySelectorAll("button[vw-deauth-user]").forEach((e=>{e.addEventListener("click",deauthUser)})),document.querySelectorAll("button[vw-delete-user]").forEach((e=>{e.addEventListener("click",deleteUser)})),document.querySelectorAll("button[vw-disable-user]").forEach((e=>{e.addEventListener("click",disableUser)})),document.querySelectorAll("button[vw-enable-user]").forEach((e=>{e.addEventListener("click",enableUser)})),document.querySelectorAll("button[vw-resend-user-invite]").forEach((e=>{e.addEventListener("click",resendUserInvite)})),jdenticon&&jdenticon()}userOrgTypeDialog.addEventListener("show.bs.modal",(function(e){const t=e.relatedTarget.parentNode.dataset.vwUserEmail,r=e.relatedTarget.parentNode.dataset.vwUserUuid,n=e.relatedTarget.dataset.vwOrgType,a=ORG_TYPES[n].name,s=e.relatedTarget.dataset.vwOrgName,o=e.relatedTarget.dataset.vwOrgUuid;document.getElementById("userOrgTypeDialogTitle").innerHTML=`<b>Update User Type:</b><br><b>Organization:</b> ${s}<br><b>User:</b> ${t}`,document.getElementById("userOrgTypeUserUuid").value=r,document.getElementById("userOrgTypeOrgUuid").value=o,document.getElementById(`userOrgType${a}`).checked=!0}),!1),userOrgTypeDialog.addEventListener("hide.bs.modal",(function(){document.getElementById("userOrgTypeDialogTitle").innerHTML="",document.getElementById("userOrgTypeUserUuid").value="",document.getElementById("userOrgTypeOrgUuid").value=""}),!1),document.addEventListener("DOMContentLoaded",(()=>{jQuery("#users-table").DataTable({drawCallback:function(){initUserTable()},stateSave:!0,responsive:!0,lengthMenu:[[-1,2,5,10,25,50],["All",2,5,10,25,50]],pageLength:-1,columnDefs:[{targets:[1,2],type:"date-iso"},{targets:6,searchable:!1,orderable:!1}]}),initUserTable();const e=document.getElementById("updateRevisions");e&&e.addEventListener("click",updateRevisions);const t=document.getElementById("reload");t&&t.addEventListener("click",reload);const r=document.getElementById("userOrgTypeForm");r&&r.addEventListener("submit",updateUserOrgType);const n=document.getElementById("inviteUserForm");n&&n.addEventListener("submit",inviteUser)}));